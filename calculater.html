<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Money Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 15px;
  margin: 0;
}

h2,h3 {
  text-align: center;
  color: #333;
}

.box {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 500px;
  margin: 20px auto;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  width: 90%;
  box-sizing: border-box;
}

@media (max-width: 480px) {
  .box {
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
    width: 95%;
  }
}

.input-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 5px;
  border-color: red;
  background-color: #33cc33;
  margin: 10px 0;
  gap: 10px;
}

.input-row label {
  flex: 1;
  font-size: 16px;
}

.input-row input[type="number"] {
  flex: 0 0 100px;
  padding: 8px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 6px;
  text-align: center;
}

.number-control {
  display: flex;
  align-items: center;
  gap: 5px;
}

.number-control button {
  width: 30px;
  height: 30px;
  font-size: 18px;
  font-weight: bold;
  border: none;
  background-color: #ccc;
  border-radius: 5px;
  cursor: pointer;
}

.number-control input[type="number"] {
  width: 60px;
  text-align: center;
  font-size: 16px;
  padding: 5px;
}

.checkbox-container {
  display: flex;
  align-items: center;
  margin: 15px 0;
  gap: 10px;
  font-size: large;
}

.notes-container {
  margin: 15px 0;
}

.notes-container textarea {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: Arial, sans-serif;
  resize: vertical;
  min-height: 60px;
}

.button-group {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.button-group button {
  flex: 1;
}

button {
  padding: 12px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}

button:hover {
  background: #0056b3;
}

button.secondary {
  background: #6c757d;
}

button.secondary:hover {
  background: #5a6268;
}

button.success {
  background: #3d3db2;
  color: white;
}

button.success:hover {
  background: #4330cf;
  color: white;
}

.result {
  margin-top: 15px;
  padding: 12px;
  background: #e9ffe9;
  border: 1px solid #33cc33;
  border-radius: 8px;
  font-size: 19px;
}

.success {
  color: #28a745;
}

.error {
  color: #dc3545;
}

.breakdown {
  margin-top: 10px;
}

.denomination {
  display: flex;
  justify-content: space-between;
  margin: 5px 0;
}

  </style>
</head>
<body>

<div class="box">
  <h2>Money Calculator</h2>
  <div style="text-align:center; margin-bottom: 15px;">
  <label for="datePicker"><strong>Select Date:</strong></label>
  <input type="date" id="datePicker">
  <button onclick="loadData()">üîÑ Load</button>
   <button class="secondary" onclick="resetToZero()">Reset to 0</button>
</div>
<div style="text-align:center; margin-bottom: 15px;">
  <label for="userName"><strong>User Name:</strong></label>
  <input type="text" id="userName" placeholder="Enter user name">
</div>
<div style="text-align:center; margin-bottom: 15px;">
  <a href="Show_All_data.html" target="_blank">üìã View All Saved Data</a>
<a > </a>  
</div>
  


  <div class="input-row">
    <label for="n500">‚Çπ500 Notes:</label>
    <div class="number-control">
      <button onclick="changeValue('n500', -1)">‚àí</button>
      <input type="number" id="n500" value="0" min="0">
      <button onclick="changeValue('n500', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="n200">‚Çπ200 Notes:</label>
    <div class="number-control">
      <button onclick="changeValue('n200', -1)">‚àí</button>
      <input type="number" id="n200" value="0" min="0">
      <button onclick="changeValue('n200', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="n100">‚Çπ100 Notes:</label>
    <div class="number-control">
      <button onclick="changeValue('n100', -1)">‚àí</button>
      <input type="number" id="n100" value="0" min="0">
      <button onclick="changeValue('n100', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="n50">‚Çπ50 Notes:</label>
    <div class="number-control">
    
      <button onclick="changeValue('n50', -1)">‚àí</button>
      <input type="number" id="n50" value="0" min="0">
      <button onclick="changeValue('n50', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="n20">‚Çπ20 Notes:</label>
    <div class="number-control">
      <button onclick="changeValue('n20', -1)">‚àí</button>
      <input type="number" id="n20" value="0" min="0">
      <button onclick="changeValue('n20', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="n10">‚Çπ10 Notes:</label>
    <div class="number-control">
      <button onclick="changeValue('n10', -1)">‚àí</button>
      <input type="number" id="n10" value="0" min="0">
      <button onclick="changeValue('n10', 1)">+</button>
    </div>
  </div>

  <h3>Coins:</h3>

  <div class="input-row">
    <label for="n5">‚Çπ5 Notes:</label>
    <div class="number-control">
      <button onclick="changeValue('n5', -1)">‚àí</button>
      <input type="number" id="n5" value="0" min="0">
      <button onclick="changeValue('n5', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="c2">‚Çπ2 Coins:</label>
    <div class="number-control">
      <button onclick="changeValue('c2', -1)">‚àí</button>
      <input type="number" id="c2" value="0" min="0">
      <button onclick="changeValue('c2', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="c1">‚Çπ1 Coins:</label>
    <div class="number-control">
      <button onclick="changeValue('c1', -1)">‚àí</button>
      <input type="number" id="c1" value="0" min="0">
      <button onclick="changeValue('c1', 1)">+</button>
    </div>
  </div>

  <h3>Chocolates:</h3>

  <div class="input-row">
    <label for="ch5">‚Çπ5 Chocolates:</label>
    <div class="number-control">
      <button onclick="changeValue('ch5', -1)">‚àí</button>
      <input type="number" id="ch5" value="0" min="0">
      <button onclick="changeValue('ch5', 1)">+</button>
    </div>
  </div>

  <div class="input-row">
    <label for="ch1">‚Çπ1 Chocolates:</label>
    <div class="number-control">
      <button onclick="changeValue('ch1', -1)">‚àí</button>
      <input type="number" id="ch1" value="0" min="0">
      <button onclick="changeValue('ch1', 1)">+</button>
    </div>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="includeChoco" checked>
    <label for="includeChoco">Include Chocolates üç´</label>
  </div>

<div style="text-align:center; margin-bottom: 10px;">
  <strong>üë• Memberships Today:</strong>
  <span id="membershipCount">0</span><br>

  <input type="number" id="manualMembership" placeholder="Enter count" min="0" style="width:100px;">
  <button onclick="saveMembershipCount()">Save</button>
</div>



  <div class="button-group">
    <button onclick="total()">Total Amount</button>
    <button onclick="calculateBreakdown()">Breakdown ‚Çπ3100</button>
  </div>

  <div class="button-group">
    <button class="secondary" onclick="saveData()">Save Data</button>
    <button class="secondary" onclick="loadData()">Load Data</button>
   
  </div>

  <div class="button-group">
    <button class="success" onclick="downloadCSV()">Download CSV</button>
        
  </div>

  <div class="result" id="totalAmountOutput"></div>
  <div class="result" id="output"></div>
  
  
    <div class="notes-container">
    <label for="notes">Notes:</label>
    <textarea id="notes" placeholder="Add any notes about this calculation..."></textarea>
  </div>
</div>

<script>
  // Run when page is ready
window.onload = function () {
  // Set today's date in the date picker
  document.getElementById("datePicker").value = new Date().toISOString().split('T')[0];

  // Optional: auto-total when input changes
  const inputs = document.querySelectorAll("input[type='number'], #includeChoco, #notes");
  inputs.forEach(input => {
    input.addEventListener("input", total);
    input.addEventListener("change", total);
  });

  total(); // Initial total calculation
};
function saveMembershipCount() {
  const date = getSelectedDate();
  const count = parseInt(document.getElementById("manualMembership").value);

  if (isNaN(count) || count < 0) {
    alert("Please enter a valid number");
    return;
  }

  const membershipData = JSON.parse(localStorage.getItem("manualMembershipData")) || {};
  membershipData[date] = count;
  localStorage.setItem("manualMembershipData", JSON.stringify(membershipData));

  updateMembershipCount();
}

function updateMembershipCount() {
  const date = getSelectedDate();
  const membershipData = JSON.parse(localStorage.getItem("manualMembershipData")) || {};
  const count = membershipData[date] || 0;

  document.getElementById("membershipCount").textContent = count;
  document.getElementById("manualMembership").value = count; // show in input
}




function getSelectedDate() {
  const picker = document.getElementById("datePicker");
  return picker.value || new Date().toISOString().split('T')[0]; // fallback to today
}
function getUserName() {
  return document.getElementById("userName").value.trim();
}


function getFormData() {
  return {
    n500: parseInt(document.getElementById("n500").value) || 0,
    n200: parseInt(document.getElementById("n200").value) || 0,
    n100: parseInt(document.getElementById("n100").value) || 0,
    n50: parseInt(document.getElementById("n50").value) || 0,
    n20: parseInt(document.getElementById("n20").value) || 0,
    n10: parseInt(document.getElementById("n10").value) || 0,
    n5: parseInt(document.getElementById("n5").value) || 0,
    c2: parseInt(document.getElementById("c2").value) || 0,
    c1: parseInt(document.getElementById("c1").value) || 0,
    ch5: parseInt(document.getElementById("ch5").value) || 0,
    ch1: parseInt(document.getElementById("ch1").value) || 0,
    includeChoco: document.getElementById("includeChoco").checked,
    notes: document.getElementById("notes").value,
    timestamp: new Date().toISOString()
  };
}

function saveData() {
  const date = getSelectedDate();
  const user = getUserName();

  if (!user) {
    alert("‚ùå Please enter a user name.");
    return;
  }

  const data = getFormData();
  let allData = JSON.parse(localStorage.getItem("moneyCalculatorAllData")) || {};

  if (!allData[date]) {
    allData[date] = {};
  }

  allData[date][user] = data;

  localStorage.setItem("moneyCalculatorAllData", JSON.stringify(allData));
  document.getElementById("output").innerHTML =
    `<div class="success">‚úÖ Data saved for ${user} on ${date}!</div>`;
}

function loadData() {
  const date = getSelectedDate();
  const user = getUserName();

  if (!user) {
    alert("‚ùå Please enter a user name.");
    return;
  }

  const allData = JSON.parse(localStorage.getItem("moneyCalculatorAllData")) || {};
  const dayData = allData[date] || {};
  const data = dayData[user];

  if (!data) {
    document.getElementById("output").innerHTML =
      `<div class="error">‚ùå No data found for ${user} on ${date}</div>`;
    return;
  }

  document.getElementById("n500").value = data.n500;
  document.getElementById("n200").value = data.n200;
  document.getElementById("n100").value = data.n100;
  document.getElementById("n50").value = data.n50;
  document.getElementById("n20").value = data.n20;
  document.getElementById("n10").value = data.n10;
  document.getElementById("n5").value = data.n5;
  document.getElementById("c2").value = data.c2;
  document.getElementById("c1").value = data.c1;
  document.getElementById("ch5").value = data.ch5;
  document.getElementById("ch1").value = data.ch1;
  document.getElementById("includeChoco").checked = data.includeChoco;
  document.getElementById("notes").value = data.notes || '';

  document.getElementById("output").innerHTML =
    `<div class="success">‚úÖ Loaded data for ${user} on ${date}!</div>`;
  total();
}
window.onload = function () {
  document.getElementById("datePicker").value = new Date().toISOString().split('T')[0];
  total();
  updateMembershipCount();
};


function downloadCSV() {
  const data = getFormData();

  if (!window.lastUsedBreakdown) {
    alert("‚ùå Please click 'Breakdown ‚Çπ3100' before downloading!");
    return;
  }

  const used = window.lastUsedBreakdown || {};
  const remaining = window.lastRemainingBreakdown || {};

  // Start CSV content
  let csv = "Denomination,Count,Value\n";

  const denominations = [
    { id: 'n500', name: '‚Çπ500 Notes', value: 500 },
    { id: 'n200', name: '‚Çπ200 Notes', value: 200 },
    { id: 'n100', name: '‚Çπ100 Notes', value: 100 },
    { id: 'n50',  name: '‚Çπ50 Notes',  value: 50 },
    { id: 'n20',  name: '‚Çπ20 Notes',  value: 20 },
    { id: 'n10',  name: '‚Çπ10 Notes',  value: 10 },
    { id: 'n5',   name: '‚Çπ5 Notes',   value: 5 },
    { id: 'c2',   name: '‚Çπ2 Coins',   value: 2 },
    { id: 'c1',   name: '‚Çπ1 Coins',   value: 1 },
    { id: 'ch5',  name: '‚Çπ5 Chocolates', value: 5 },
    { id: 'ch1',  name: '‚Çπ1 Chocolates', value: 1 }
  ];

  let totalEntered = 0;
  for (const denom of denominations) {
    const count = data[denom.id];
    if (count > 0) {
      const amount = count * denom.value;
      totalEntered += amount;
      csv += `${denom.name},${count},${amount}\n`;
    }
  }

  csv += `\nTotal Entered,,${totalEntered}\n`;

  // Used Breakdown
  csv += `\nüßæ Used for ‚Çπ3100:\nDenomination,Count,Value\n`;
  let usedTotal = 0;
  for (const id in used) {
    const denom = denominations.find(d => d.id === `n${id}` || d.id === `c${id}` || d.id === `ch${id}` || d.id === id);
    const count = used[id];
    if (denom) {
      const value = count * denom.value;
      usedTotal += value;
      csv += `${denom.name},${count},${value}\n`;
    }
  }
  csv += `Used Total,,${usedTotal}\n`;

  // Remaining Breakdown
  csv += `\nüí∞ Remaining:\nDenomination,Count,Value\n`;
  let remTotal = 0;
  for (const id in remaining) {
    const denom = denominations.find(d => d.id === `n${id}` || d.id === `c${id}` || d.id === `ch${id}` || d.id === id);
    const count = remaining[id];
    if (denom) {
      const value = count * denom.value;
      remTotal += value;
      csv += `${denom.name},${count},${value}\n`;
    }
  }
  csv += `Remaining Total,,${remTotal}\n`;

  // Notes and timestamp
  csv += `\nNotes,"${data.notes.replace(/"/g, '""')}"\n`;
  csv += `Date,${new Date().toLocaleString('en-IN', { hour12: true })}\n`;

  // Download
 const now = new Date();
const formattedDateTime = now.toLocaleString('en-GB', {
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
  hour12: false
}).replace(/[/,: ]/g, '-'); // Makes it filename-safe

const filename = `money_calculator_${formattedDateTime}.csv`;
downloadFile(csv, filename, 'text/csv');

}
function downloadFile(content, filename, type) {
  const BOM = "\uFEFF";
  const blob = new Blob([BOM + content], { type });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}



function calculateTotal(data) {
  let totalAmount =
    500 * data.n500 +
    200 * data.n200 +
    100 * data.n100 +
    50 * data.n50 +
    20 * data.n20 +
    10 * data.n10 +
    5 * data.n5 +
    2 * data.c2 +
    1 * data.c1;

  if (data.includeChoco) {
    totalAmount += 5 * data.ch5 + 1 * data.ch1;
  }

  return totalAmount;
}

function total() {
  const data = getFormData();
  const totalAmount = calculateTotal(data);

  let resultText = `<div class="success">‚úÖ Total Amount: ‚Çπ${totalAmount}</div>`;
  resultText += data.includeChoco ?
    `<div class="breakdown">üç´ Chocolates Included</div>` :
    `<div class="breakdown">‚ùå Chocolates Not Included</div>`;

  if (data.notes) {
    resultText += `<div class="breakdown">üìù Notes: ${data.notes}</div>`;
  }

  document.getElementById("totalAmountOutput").innerHTML = resultText;
}

function changeValue(id, delta) {
  const input = document.getElementById(id);
  const current = parseInt(input.value) || 0;
  const min = parseInt(input.min) || 0;
  const newVal = Math.max(current + delta, min);
  input.value = newVal;
  input.dispatchEvent(new Event('input')); // To trigger live calculation
}
function calculateBreakdown() {
 setTimeout(() => {
  const available = {
    500: parseInt(document.getElementById("n500").value) || 0,
    200: parseInt(document.getElementById("n200").value) || 0,
    100: parseInt(document.getElementById("n100").value) || 0,
    50: parseInt(document.getElementById("n50").value) || 0,
    20: parseInt(document.getElementById("n20").value) || 0,
    10: parseInt(document.getElementById("n10").value) || 0,
    5: parseInt(document.getElementById("n5").value) || 0,
    2: parseInt(document.getElementById("c2").value) || 0,
    1: parseInt(document.getElementById("c1").value) || 0,
    ch5: parseInt(document.getElementById("ch5").value) || 0,
    ch1: parseInt(document.getElementById("ch1").value) || 0
  };

  const useChoco = document.getElementById("includeChoco").checked;
  const target = 3100;
  let remaining = target;
  const used = {};

  const denominations = [
    { type: 'coin', value: 1, id: '1' },
    { type: 'coin', value: 2, id: '2' },
    { type: 'note', value: 5, id: '5' },
    { type: 'note', value: 10, id: '10' },
    { type: 'note', value: 20, id: '20' },
    { type: 'note', value: 50, id: '50' },
    { type: 'note', value: 100, id: '100' },
    { type: 'note', value: 200, id: '200' },
    { type: 'note', value: 500, id: '500' }
  ];

  if (useChoco) {
    denominations.push({ type: 'chocolate', value: 5, id: 'ch5' });
    denominations.push({ type: 'chocolate', value: 1, id: 'ch1' });
  }

  // Step 1: Smallest first
  denominations.sort((a, b) => a.value - b.value);
  for (const denom of denominations) {
    if (remaining <= 0) break;
    const maxPossible = Math.min(Math.floor(remaining / denom.value), available[denom.id]);
    if (maxPossible > 0) {
      used[denom.id] = maxPossible;
      remaining -= maxPossible * denom.value;
    }
  }

  // Step 2: Fill remaining with big notes if possible
  if (remaining > 0) {
    denominations.sort((a, b) => b.value - a.value);
    for (const denom of denominations) {
      if (remaining <= 0) break;
      const availableCount = available[denom.id] - (used[denom.id] || 0);
      const needed = Math.ceil(remaining / denom.value);
      const add = Math.min(needed, availableCount);
      if (add > 0) {
        used[denom.id] = (used[denom.id] || 0) + add;
        remaining -= add * denom.value;
      }
    }
  }

  // Calculate total used
  let total = 0;
  for (const id in used) {
    const val = (id === 'ch5') ? 5 : (id === 'ch1') ? 1 : parseInt(id);
    total += used[id] * val;
  }

  // Store used and remaining for export
window.lastUsedBreakdown = used;
window.lastRemainingBreakdown = {};

for (const denom of Object.keys(available)) {
  const remainingCount = available[denom] - (used[denom] || 0);
  if (remainingCount > 0) {
    window.lastRemainingBreakdown[denom] = remainingCount;
  }
}


  // Try to reduce excess
  if (total > 3200) {
    let excess = total - 3100;
    const reduceOrder = [
      { id: '500', value: 500 },
      { id: '200', value: 200 },
      { id: '100', value: 100 },
      { id: '50', value: 50 },
      { id: '20', value: 20 },
      { id: '10', value: 10 },
      { id: '5', value: 5 },
      { id: '2', value: 2 },
      { id: '1', value: 1 },
      { id: 'ch5', value: 5 },
      { id: 'ch1', value: 1 }
    ];
    for (const denom of reduceOrder) {
      while (used[denom.id] > 0 && total - denom.value >= 3100) {
        used[denom.id] -= 1;
        total -= denom.value;
        excess -= denom.value;
      }
      if (total <= 3125) break;
    }
  }

  // Step 3: Create breakdown HTML
  let breakdownHTML = '<div class="breakdown"><strong>üßæ Used :</strong>';
  const displayOrder = [
    { id: '500', name: '‚Çπ500' },
    { id: '200', name: '‚Çπ200' },
    { id: '100', name: '‚Çπ100' },
    { id: '50', name: '‚Çπ50' },
    { id: '20', name: '‚Çπ20' },
    { id: '10', name: '‚Çπ10' },
    { id: '5', name: '‚Çπ5' },
    { id: '2', name: '‚Çπ2' },
    { id: '1', name: '‚Çπ1' },
    { id: 'ch5', name: '‚Çπ5 Chocolate' },
    { id: 'ch1', name: '‚Çπ1 Chocolate' }
  ];

  for (const denom of displayOrder) {
    if (used[denom.id] > 0) {
      const value = denom.id === 'ch5' ? 5 : denom.id === 'ch1' ? 1 : parseInt(denom.id);
      const count = used[denom.id];
      const amount = count * value;
      breakdownHTML += `
        <div class="denomination">
          <span>${denom.name} √ó ${count}</span>
          <span>= ‚Çπ${amount}</span>
        </div>`;
    }
  }
  breakdownHTML += `</div><div class="total">Total: ‚Çπ${total}</div>`;

  // Step 4: Remaining HTML
  let remainingHTML = '<div class="breakdown"><strong>üí∞ Remaining:</strong>';
  for (const denom of displayOrder) {
    const totalAvailable = available[denom.id] || 0;
    const usedCount = used[denom.id] || 0;
    const remainCount = totalAvailable - usedCount;
    if (remainCount > 0) {
      const value = denom.id === 'ch5' ? 5 : denom.id === 'ch1' ? 1 : parseInt(denom.id);
      let amount = remainCount * value;
      
      remainingHTML += `
        <div class="denomination">
          <span>${denom.name} √ó ${remainCount}</span>
          <span>= ‚Çπ${amount}</span>
        </div>`;
    }
  }
  remainingHTML += '</div>';

  const resultBox = document.getElementById("output");

  if (remaining === 0 || (total >= 3100 && total <= 3200)) {
    resultBox.innerHTML = `
      <div class="success">‚úÖ ‚Çπ${total} (within acceptable range of ‚Çπ3100‚Äì‚Çπ3050)</div>
      ${breakdownHTML}
      ${remainingHTML}`;
  } else {
    resultBox.innerHTML = `
      <div class="error">‚ùå Cannot reach ‚Çπ3100. Maximum possible: ‚Çπ${total}</div>
      ${breakdownHTML}
      ${remainingHTML}`;
  }
  }, 300);
}
function resetToZero() {
  const fields = [
    "n500", "n200", "n100", "n50", "n20", "n10",
    "n5", "c2", "c1", "ch5", "ch1"
  ];
  fields.forEach(id => document.getElementById(id).value = 0);

  document.getElementById("includeChoco").checked = true;
  document.getElementById("notes").value = "";

  total(); // Recalculate total
}

window.onload = function () {
  document.getElementById("datePicker").value = new Date().toISOString().split('T')[0];
  
  const inputs = document.querySelectorAll("input[type='number'], #includeChoco, #notes");
  inputs.forEach(input => {
    input.addEventListener("input", total);
    input.addEventListener("change", total);
  });

  total();
  updateMembershipCount(); // ‚Üê Add this line
};

</script>
</body>
</html>






